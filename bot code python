import discord
from discord.ext import commands
from discord.ext.commands import BucketType
import aiohttp
import asyncio

TOKEN = ""

intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix="!", intents=intents)

API_LIKE = "https://huutri.id.vn/api/freefire/like?uid={}"
API_INFO = "https://huutri.id.vn/api/freefire/info?uid={}"


# ==== Sá»° KIá»†N ====
@bot.event
async def on_ready():
    print(f"âœ… Bot Ä‘Ã£ Ä‘Äƒng nháº­p thÃ nh cÃ´ng dÆ°á»›i tÃªn {bot.user}")


# ==== COMMAND: Láº¤Y INFO UID ====
@bot.command()
async def info(ctx, uid: str):
    """Láº¥y thÃ´ng tin tÃ i khoáº£n Free Fire theo UID"""
    url = API_INFO.format(uid)
    async with aiohttp.ClientSession() as session:
        try:
            async with session.get(url, timeout=10) as resp:
                if resp.status != 200:
                    return await ctx.send("âŒ API lá»—i hoáº·c khÃ´ng truy cáº­p Ä‘Æ°á»£c!")

                data = await resp.json()

                basic = data.get("basicInfo", {})
                nickname = basic.get("nickname", "KhÃ´ng rÃµ")
                level = basic.get("level", "?")
                liked = basic.get("liked", "?")

                msg = (
                    f"ğŸ® **ThÃ´ng tin Free Fire**\n"
                    f"ğŸ‘¤ TÃªn: {nickname}\n"
                    f"â­ Level: {level}\n"
                    f"ğŸ‘ Like: {liked}"
                )
                await ctx.send(msg)

        except Exception as e:
            await ctx.send(f"âš ï¸ Lá»—i: {e}")


# ==== COMMAND: TÄ‚NG LIKE ====
@bot.command()
async def like(ctx, uid: str):
    """TÄƒng like cho UID"""
    url = API_LIKE.format(uid)
    async with aiohttp.ClientSession() as session:
        try:
            async with session.get(url, timeout=10) as resp:
                if resp.status != 200:
                    return await ctx.send("âŒ KhÃ´ng thá»ƒ gá»i API!")

                data = await resp.json()
                if "likes" in data:
                    before = data["likes"]["before"]
                    after = data["likes"]["after"]
                    added = data["likes"]["added_by_api"]

                    msg = (
                        f"âœ… Like thÃ nh cÃ´ng!\n"
                        f"ğŸ‘¤ UID: {uid}\n"
                        f"ğŸ‘ TrÆ°á»›c: {before} â†’ Sau: {after} (+{added})"
                    )
                    await ctx.send(msg)
                else:
                    await ctx.send("âŒ API khÃ´ng tráº£ dá»¯ liá»‡u há»£p lá»‡!")

        except Exception as e:
            await ctx.send(f"âš ï¸ Lá»—i: {e}")


# ==== COMMAND: SPAM LIKE ====
@bot.command()
@commands.cooldown(rate=1, per=5, type=BucketType.user)  # cooldown 5s má»—i user
async def spamlike(ctx, uid: str, times: int = 5):
    """Spam tÄƒng like nhiá»u láº§n cho UID"""
    url = API_LIKE.format(uid)
    async with aiohttp.ClientSession() as session:
        for i in range(times):
            try:
                async with session.get(url, timeout=10) as resp:
                    if resp.status == 200:
                        data = await resp.json()
                        after = data.get("likes", {}).get("after", "?")
                        await ctx.send(f"ğŸ”¥ {i+1}/{times} â†’ UID {uid} Like hiá»‡n táº¡i: {after}")
                    else:
                        await ctx.send(f"âŒ API lá»—i á»Ÿ láº§n {i+1}")
            except Exception as e:
                await ctx.send(f"âš ï¸ Lá»—i á»Ÿ láº§n {i+1}: {e}")
            await asyncio.sleep(1)  # delay 1s má»—i láº§n trÃ¡nh spam quÃ¡ nhanh


# ==== CHáº Y BOT ====
bot.run(TOKEN)